<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WpfApp1"
        xmlns:Controls="http://schemas.stackdose.com/wpf"
     
    
    x:Class="WpfApp1.MainWindow"
        mc:Ignorable="d"
        Title="MainWindow" Height="900" Width="1600">
    <Grid>

        <Controls:CyberFrame Title="UBI SYSTEM"/>
        <Controls:PlcStatus x:Name="MainPlc" HorizontalAlignment="Left" Margin="73,89,0,0" VerticalAlignment="Top" IpAddress="192.168.22.39" Port="3000" AutoConnect="False" MonitorAddress="D0,12,M1,10,D90,11,R2000,R2002,M237,10" MonitorLength="1" ScanInterval="120"/>
        <Controls:PlcLabel HorizontalAlignment="Left" Margin="307,97,0,0" VerticalAlignment="Top" Width="130" Height="45" Label="X軸位置"
                            Address="D10" DefaultValue="00000" DataType="Word"
                           />
        <Controls:PlcLabel HorizontalAlignment="Left" Margin="307,159,0,0" VerticalAlignment="Top" Width="130" Height="45" Label="事件偵測"
             Address="M237" DefaultValue="OFF" DataType="Bit" BitIndex="-1"
                           />
        <Controls:PlcLabel HorizontalAlignment="Left" Margin="484,97,0,0" VerticalAlignment="Top" Width="130" Height="45" Label="X軸位置"
             Address="D10" DefaultValue="00000" BitIndex="-1" DataType="DWord"
                           />
        <Controls:PlcLabel HorizontalAlignment="Left" Margin="484,159,0,0" VerticalAlignment="Top" Width="130" Height="45" Label="X軸位置"
            Address="M1" DefaultValue="00000" DataType="Bit" BitIndex="0"
                           />
        <Controls:PlcLabel HorizontalAlignment="Left" Margin="307,222,0,0" VerticalAlignment="Top" Width="130" Height="45" Label="R2000"
            Address="R2000" DefaultValue="00000" DataType="Word" BitIndex="-1"
                           />
        <Controls:PlcText HorizontalAlignment="Left" Margin="73,334,0,0" VerticalAlignment="Top" Width="267" 
                          Label="PLC Input" 
                          Address="D100" 
                          Value="0" 
                          Reason="Manual Test"
                          EnableAuditTrail="True"/>

        <!-- 🔥 移除附加行為，PlcLabelContext 會自動處理 -->
        <Controls:PlcLabel x:Name="LblTemp" 
                           HorizontalAlignment="Left" Margin="484,222,0,0" VerticalAlignment="Top" 
                           Width="130" Height="45" 
                           Label="溫度"
                           Address="R2002" 
                           DefaultValue="00000" 
                           DataType="Word" 
                           BitIndex="-1" 
                           Divisor="10"/>

        <Controls:PlcLabel HorizontalAlignment="Left" Margin="640,97,0,0" VerticalAlignment="Top" Width="130" Height="45" Label="X軸位置"
            Address="D11" DefaultValue="OFF" BitIndex="0" DataType="Bit"
                           />
        <Controls:PlcLabel HorizontalAlignment="Left" Margin="683,214,0,0" VerticalAlignment="Top" Width="153" DefaultValue="00000" EnableAuditTrail="True" EnableDataLog="True" DataType="Bit" BitIndex="0"/>
        <Controls:LiveLogViewer HorizontalAlignment="Left" Margin="418,472,0,0" VerticalAlignment="Top" Height="200" Width="418"/>
        <Controls:PlcLabel HorizontalAlignment="Left" Margin="591,285,0,0" VerticalAlignment="Top" Width="245" DefaultValue="00000" EnableAuditTrail="True" EnableDataLog="True" ShowLog="False"/>

        <!-- 新增：SensorViewer 感測器監控 -->
        <Controls:SensorViewer HorizontalAlignment="Left" Margin="1076,89,0,0" VerticalAlignment="Top" 
                               Width="458" Height="367"
                               Title="SENSOR Viewer"
                               ConfigFile="Sensors.json"
                               EnableGrouping="True"
                               AutoStart="True"
                               RefreshInterval="499"/>

        <!-- 🔥 新增：PlcEventTrigger 隱藏的事件觸發器 -->
        <!-- 偵測 M237 觸發 Recipe 1 選擇事件 -->
        <Controls:PlcEventTrigger Address="M237" 
                                  EventName="Recipe1Selected"
                                  AutoClear="True"
                                  ClearDelay="0"
                                  TriggerCondition="OnRising"
                                  TargetStatus="{Binding ElementName=MainPlc}"/>

        <!-- 偵測 M238 觸發 Recipe 2 選擇事件 -->
        <Controls:PlcEventTrigger Address="M238" 
                                  EventName="Recipe2Selected"
                                  AutoClear="True"
                                  ClearDelay="0"
                                  TriggerCondition="OnRising"
                                  TargetStatus="{Binding ElementName=MainPlc}"/>

        <!-- 測試按鈕：驗證 CyberMessageBox 執行緒安全性 -->
        <StackPanel HorizontalAlignment="Left" Margin="73,472,0,0" VerticalAlignment="Top" Width="300">
            <Button Content="測試 UI 執行緒 MessageBox" 
                    Command="{Binding TestUIThreadMessageBoxCommand}"
                    Height="35" Margin="0,5" Background="#1E1E2E" Foreground="White" BorderBrush="#00E5FF"/>
            <Button Content="測試背景執行緒 MessageBox" 
                    Command="{Binding TestBackgroundMessageBoxCommand}"
                    Height="35" Margin="0,5" Background="#1E1E2E" Foreground="White" BorderBrush="#FFA726"/>
            <Button Content="測試連續多個 MessageBox" 
                    Command="{Binding TestMultipleMessageBoxCommand}"
                    Height="35" Margin="0,5" Background="#1E1E2E" Foreground="White" BorderBrush="#4CAF50"/>
        </StackPanel>
     

    </Grid>

</Window>
