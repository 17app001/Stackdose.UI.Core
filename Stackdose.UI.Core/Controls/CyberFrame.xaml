<UserControl x:Class="Stackdose.UI.Core.Controls.CyberFrame"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Stackdose.UI.Core.Controls"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch"
             x:Name="Root">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <!-- Main Window Frame -->
    <Border Background="{DynamicResource Cyber.Bg.Dark}" 
            BorderBrush="{DynamicResource Cyber.Border}" 
            BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="50"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header Bar -->
            <Border Grid.Row="0" 
                    Background="{DynamicResource Cyber.Bg.Panel}" 
                    BorderBrush="{DynamicResource Cyber.Border.Strong}" 
                    BorderThickness="0,0,0,2">
                <Grid Margin="15,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- LEFT SECTION: Logo + Title + Theme Button -->
                    <StackPanel Grid.Column="0" 
                                Orientation="Horizontal" 
                                VerticalAlignment="Center">
                        <TextBlock Text="Stackdose" 
                                   Foreground="{DynamicResource Cyber.NeonBlue}" 
                                   FontSize="20" 
                                   FontWeight="Bold" 
                                   FontStyle="Italic" 
                                   Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding Title, ElementName=Root}" 
                                   Foreground="{DynamicResource Cyber.Text.Bright}" 
								   d:Text="MODEL NAME"
                                   FontSize="14" 
                                   FontWeight="Medium"
                                   VerticalAlignment="Center" 
                                   Margin="0,0,15,0"
								   Padding="6,0,0,0"
								   />
                        
                        <!-- ðŸ”¥ Separator -->
                        <Border Width="1" 
                                Height="30" 
                                Background="{DynamicResource Cyber.Border.Strong}" 
                                Margin="0,0,15,0"/>
                        
                        <!-- ðŸ”¥ PLC Status Indicator (Integrated) -->
                        <local:PlcStatus x:Name="IntegratedPlcStatus"                                                
                                                 Width="220"
                                                 Margin="0,0,15,0" 
                                                 IpAddress="{Binding PlcIpAddress, ElementName=Root}" 
                                                 Port="{Binding PlcPort, ElementName=Root}" 
                                                 ScanInterval="{Binding PlcScanInterval, ElementName=Root}"
                                                 AutoConnect="{Binding PlcAutoConnect, ElementName=Root}"
                                                 Visibility="{Binding ShowPlcStatus, ElementName=Root, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                 ShowBorder="False"/>
                        
                        <!-- Theme Toggle Button -->
                        <Button x:Name="ThemeToggleButton" 
                                Click="ThemeToggleButton_Click"
                                Width="32" 
                                Height="32" 
                                Background="Transparent" 
                                BorderBrush="{DynamicResource Cyber.Border.Strong}"
                                BorderThickness="1"
                                Cursor="Hand"
                                ToolTip="åˆ‡æ›ä¸»é¡Œ (Dark/Light)">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="ButtonBorder"
                                                        Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6">
                                                    <!-- æœˆäº®åœ–æ¨™ (Dark Theme) -->
                                                    <Viewbox Width="18" Height="18" Stretch="Uniform">
                                                        <Canvas Width="24" Height="24">
                                                            <!-- æœˆäº®å½¢ç‹€ -->
                                                            <Path Data="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" 
                                                                  Fill="{DynamicResource Cyber.NeonBlue}" 
                                                                  Stroke="{DynamicResource Cyber.NeonBlue}"
                                                                  StrokeThickness="0.5">
                                                                <Path.Effect>
                                                                    <DropShadowEffect Color="#00E5FF" 
                                                                                      BlurRadius="8" 
                                                                                      ShadowDepth="0" 
                                                                                      Opacity="0.6"/>
                                                                </Path.Effect>
                                                            </Path>
                                                        </Canvas>
                                                    </Viewbox>
                                    
                                                    <Border.Effect>
                                                        <DropShadowEffect x:Name="GlowEffect"
                                                                          Color="#00E5FF" 
                                                                          BlurRadius="0" 
                                                                          ShadowDepth="0" 
                                                                          Opacity="0"/>
                                                    </Border.Effect>
                                                </Border>
                                                
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Trigger.EnterActions>
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                                                    Storyboard.TargetProperty="Background.Color"
                                                                                    To="#1A4A5F7F"
                                                                                    Duration="0:0:0.2"/>
                                                                    <DoubleAnimation Storyboard.TargetName="GlowEffect"
                                                                                     Storyboard.TargetProperty="BlurRadius"
                                                                                     To="15"
                                                                                     Duration="0:0:0.2"/>
                                                                    <DoubleAnimation Storyboard.TargetName="GlowEffect"
                                                                                     Storyboard.TargetProperty="Opacity"
                                                                                     To="0.5"
                                                                                     Duration="0:0:0.2"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.EnterActions>
                                                        <Trigger.ExitActions>
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                                                    Storyboard.TargetProperty="Background.Color"
                                                                                    To="Transparent"
                                                                                    Duration="0:0:0.2"/>
                                                                    <DoubleAnimation Storyboard.TargetName="GlowEffect"
                                                                                     Storyboard.TargetProperty="BlurRadius"
                                                                                     To="0"
                                                                                     Duration="0:0:0.2"/>
                                                                    <DoubleAnimation Storyboard.TargetName="GlowEffect"
                                                                                     Storyboard.TargetProperty="Opacity"
                                                                                     To="0"
                                                                                     Duration="0:0:0.2"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.ExitActions>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>

                        <!-- User Management Toggle Button -->
                        <Button x:Name="UserManagementToggleButton" 
                                Click="UserManagementToggleButton_Click"
                                Width="32" 
                                Height="32" 
                                Background="Transparent" 
                                BorderBrush="{DynamicResource Cyber.Border.Strong}"
                                BorderThickness="1"
                                Cursor="Hand"
                                ToolTip="User Management (Supervisor/Admin)"
                                Margin="10,0,0,0">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="ButtonBorder"
                                                        Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6">
                                                    <Viewbox Width="18" Height="18" Stretch="Uniform">
                                                        <Canvas Width="24" Height="24">
                                                            <Path Data="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" 
                                                                  Fill="{DynamicResource Cyber.NeonBlue}" 
                                                                  Stroke="{DynamicResource Cyber.NeonBlue}"
                                                                  StrokeThickness="0.5">
                                                                <Path.Effect>
                                                                    <DropShadowEffect Color="#00E5FF" 
                                                                                      BlurRadius="8" 
                                                                                      ShadowDepth="0" 
                                                                                      Opacity="0.6"/>
                                                                </Path.Effect>
                                                            </Path>
                                                        </Canvas>
                                                    </Viewbox>
                                    
                                                    <Border.Effect>
                                                        <DropShadowEffect x:Name="GlowEffect"
                                                                          Color="#00E5FF" 
                                                                          BlurRadius="0" 
                                                                          ShadowDepth="0" 
                                                                          Opacity="0"/>
                                                    </Border.Effect>
                                                </Border>
                                                
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Trigger.EnterActions>
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                                                    Storyboard.TargetProperty="Background.Color"
                                                                                    To="#1A4A5F7F"
                                                                                    Duration="0:0:0.2"/>
                                                                    <DoubleAnimation Storyboard.TargetName="GlowEffect"
                                                                                     Storyboard.TargetProperty="BlurRadius"
                                                                                     To="15"
                                                                                     Duration="0:0:0.2"/>
                                                                    <DoubleAnimation Storyboard.TargetName="GlowEffect"
                                                                                     Storyboard.TargetProperty="Opacity"
                                                                                     To="0.5"
                                                                                     Duration="0:0:0.2"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.EnterActions>
                                                        <Trigger.ExitActions>
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                                                    Storyboard.TargetProperty="Background.Color"
                                                                                    To="Transparent"
                                                                                    Duration="0:0:0.2"/>
                                                                    <DoubleAnimation Storyboard.TargetName="GlowEffect"
                                                                                     Storyboard.TargetProperty="BlurRadius"
                                                                                     To="0"
                                                                                     Duration="0:0:0.2"/>
                                                                    <DoubleAnimation Storyboard.TargetName="GlowEffect"
                                                                                     Storyboard.TargetProperty="Opacity"
                                                                                     To="0"
                                                                                     Duration="0:0:0.2"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.ExitActions>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>

                    <!-- CENTER SECTION: Status Indicators -->
                    <StackPanel x:Name="StatusIndicatorsPanel"
                                Grid.Column="1" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Center" 
                                VerticalAlignment="Center"
                                Visibility="Collapsed">
                        <Border Background="#F44336" 
                                CornerRadius="4" 
                                Padding="8,4" 
                                Margin="5"
                                BorderBrush="#FFFFFF"
                                BorderThickness="1">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="[!]" 
                                           Foreground="White" 
                                           FontSize="12" 
                                           FontWeight="Bold"
                                           Margin="0,0,5,0"/>
                                <TextBlock Text="Alarm: 0" 
                                           Foreground="White" 
                                           FontSize="11" 
                                           FontWeight="Medium"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#4CAF50" 
                                CornerRadius="4" 
                                Padding="8,4" 
                                Margin="5"
                                BorderBrush="#FFFFFF"
                                BorderThickness="1">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="[v]" 
                                           Foreground="White" 
                                           FontSize="12" 
                                           FontWeight="Bold"
                                           Margin="0,0,5,0"/>
                                <TextBlock Text="Total: 10" 
                                           Foreground="White" 
                                           FontSize="11" 
                                           FontWeight="Medium"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- RIGHT SECTION: Time + User + Logout -->
                    <StackPanel Grid.Column="2" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Right" 
                                VerticalAlignment="Center">
                        
                        <!-- ðŸ”¥ æ‰¹æ¬¡å¯«å…¥ç‹€æ…‹ç‡ˆè™Ÿ -->
                        <Border x:Name="BatchWriteIndicator"
                                Width="16" 
                                Height="16" 
                                CornerRadius="8"
                                Background="#F44336"
                                Margin="0,0,10,0"
                                ToolTip="æ‰¹æ¬¡å¯«å…¥ç‹€æ…‹ï¼šç´…è‰²=é–’ç½®ï¼Œç¶ è‰²=å¯«å…¥ä¸­">
                            <Border.Effect>
                                <DropShadowEffect x:Name="BatchWriteShadow"
                                                  Color="#F44336" 
                                                  BlurRadius="12" 
                                                  ShadowDepth="0" 
                                                  Opacity="0.7"/>
                            </Border.Effect>
                        </Border>
                        
                        <!-- Time Display -->
                        <TextBlock x:Name="TimeText" 
                                   Text="00:00:00" 
                                   Foreground="{DynamicResource Cyber.NeonBlue}" 
                                   FontSize="14" 
                                   FontWeight="Bold" 
                                   FontFamily="Consolas"
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"/>

                        <!-- Separator -->
                        <TextBlock Text="|" 
                                   Foreground="{DynamicResource Cyber.Border.Strong}" 
                                   FontSize="14" 
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"/>

                        <!-- User Info Display -->
                        <StackPanel Orientation="Horizontal" 
                                    VerticalAlignment="Center"
                                    Margin="0,0,15,0">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock x:Name="UserNameText" 
                                           Text="Engineer" 
                                           Foreground="{DynamicResource Cyber.Text.Bright}" 
                                           FontSize="13" 
                                           FontWeight="SemiBold"/>
                                <TextBlock x:Name="UserLevelText" 
                                           Text="Engineer" 
                                           Foreground="{DynamicResource Cyber.NeonBlue}" 
                                           FontSize="10"
                                           FontWeight="Medium"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Logout Button -->
                        <Button x:Name="LogoutButton" 
                                Click="LogoutButton_Click"
                                Width="32" 
                                Height="32" 
                                Background="#FF5252" 
                                BorderBrush="Transparent"
                                BorderThickness="0"
                                Cursor="Hand"
                                ToolTip="ç™»å‡ºç³»çµ±">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="#FF5252"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Grid>
                                                    <Border x:Name="ButtonBorder"
                                                            Background="{TemplateBinding Background}" 
                                                            CornerRadius="8"
                                                            BorderBrush="#FFFFFF"
                                                            BorderThickness="0">
                                                        <!-- é›»æºåœ–æ¨™ -->
                                                        <Viewbox Width="20" Height="20" Stretch="Uniform">
                                                            <Canvas Width="24" Height="24">
                                                                <!-- é›»æºç¬¦è™Ÿ (åœ“å¼§ + ç›´ç·š) -->
                                                                <Path Data="M18.36 6.64a9 9 0 1 1-12.73 0" 
                                                                      Stroke="White" 
                                                                      StrokeThickness="2.5" 
                                                                      Fill="Transparent"/>
                                                                <Line X1="12" Y1="2" X2="12" Y2="12" 
                                                                      Stroke="White" 
                                                                      StrokeThickness="2.5"/>
                                                            </Canvas>
                                                        </Viewbox>
                                
                                                        <Border.Effect>
                                                            <DropShadowEffect x:Name="ButtonShadow"
                                                                              Color="#FF5252" 
                                                                              BlurRadius="0" 
                                                                              ShadowDepth="0" 
                                                                              Opacity="0"/>
                                                        </Border.Effect>
                                                    </Border>
                                                
                                                    <!-- Hover æ™‚çš„å¤–æ¡†å…‰æšˆ -->
                                                    <Border x:Name="GlowBorder"
                                                            CornerRadius="8"
                                                            BorderBrush="White"
                                                            BorderThickness="2"
                                                            Opacity="0"/>
                                                </Grid>
                                                
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Trigger.EnterActions>
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <!-- èƒŒæ™¯è®Šæš— -->
                                                                    <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                                                    Storyboard.TargetProperty="Background.Color"
                                                                                    To="#E53935"
                                                                                    Duration="0:0:0.15"/>
                                                                    <!-- ç™¼å…‰æ•ˆæžœ -->
                                                                    <DoubleAnimation Storyboard.TargetName="ButtonShadow"
                                                                                     Storyboard.TargetProperty="BlurRadius"
                                                                                     To="20"
                                                                                     Duration="0:0:0.15"/>
                                                                    <DoubleAnimation Storyboard.TargetName="ButtonShadow"
                                                                                     Storyboard.TargetProperty="Opacity"
                                                                                     To="0.8"
                                                                                     Duration="0:0:0.15"/>
                                                                    <!-- å¤–æ¡†å‡ºç¾ -->
                                                                    <DoubleAnimation Storyboard.TargetName="GlowBorder"
                                                                                     Storyboard.TargetProperty="Opacity"
                                                                                     To="0.6"
                                                                                     Duration="0:0:0.15"/>
                                                                    <!-- è¼•å¾®æ”¾å¤§ -->
                                                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                                                     To="1.05"
                                                                                     Duration="0:0:0.15"/>
                                                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                                                     To="1.05"
                                                                                     Duration="0:0:0.15"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.EnterActions>
                                                        <Trigger.ExitActions>
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <ColorAnimation Storyboard.TargetName="ButtonBorder"
                                                                                    Storyboard.TargetProperty="Background.Color"
                                                                                    To="#FF5252"
                                                                                    Duration="0:0:0.15"/>
                                                                    <DoubleAnimation Storyboard.TargetName="ButtonShadow"
                                                                                     Storyboard.TargetProperty="BlurRadius"
                                                                                     To="0"
                                                                                     Duration="0:0:0.15"/>
                                                                    <DoubleAnimation Storyboard.TargetName="ButtonShadow"
                                                                                     Storyboard.TargetProperty="Opacity"
                                                                                     To="0"
                                                                                     Duration="0:0:0.15"/>
                                                                    <DoubleAnimation Storyboard.TargetName="GlowBorder"
                                                                                     Storyboard.TargetProperty="Opacity"
                                                                                     To="0"
                                                                                     Duration="0:0:0.15"/>
                                                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                                                     To="1.0"
                                                                                     Duration="0:0:0.15"/>
                                                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                                                     To="1.0"
                                                                                     Duration="0:0:0.15"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.ExitActions>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="RenderTransform">
                                        <Setter.Value>
                                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Content Area -->
            <Grid Grid.Row="1">
                <!-- Normal Content -->
                <ContentControl x:Name="NormalContentPresenter" 
                               Content="{Binding MainContent, ElementName=Root}"
                               Grid.Row="0"
                               Panel.ZIndex="1"
                               Visibility="Visible"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Stretch"/>
                
                <!-- User Management Panel -->
                <local:UserManagementPanel x:Name="UserManagementPanel" 
                                          Grid.Row="0"
                                          Panel.ZIndex="0"
                                          Visibility="Collapsed"
                                          HorizontalAlignment="Stretch"
                                          VerticalAlignment="Stretch"/>
            </Grid>
        </Grid>
    </Border>
</UserControl>
